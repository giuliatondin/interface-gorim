<div class="history content pt-5 pb-5" *ngIf="(history$ | async) as history">
    <div class="container main__block pt-2 pb-3 pl-3 pr-3">
        <div class="mb-3">
            <h2 class="text-center pt-2 pb-3">Histórico {{ history.nome }} (Prefeito) </h2>
            <mat-accordion *ngFor="let rodada of history.rodadas">
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title class="title">
                            Rodada {{ rodada.rodada }}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-accordion *ngFor="let etapa of rodada.etapas">
                        <mat-expansion-panel>
                            <mat-expansion-panel-header>
                                <mat-panel-title class="title">
                                    Etapa {{ etapa.etapa }}
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="row align-items-center">
                                <div class="col-md-3 mb-3">
                                    <div class="history-list-info">Caixa Anterior: D${{ etapa.saldoAnterior }}</div>
                                </div>
                            </div>
                            <h3><span style="color: lightgreen;">Créditos</span></h3>
                            <div class="row align-items-center">
                                <div class="col-md-3 mb-3">
                                    <p>Impostos D${{ etapa.impostos }}</p>
                                </div>
                                <div class="col-md-3 mb-3" *ngIf="etapa.transferencias.recebido">
                                    <div class="row" *ngFor="let recebida of etapa.transferencias.recebido">
                                        <div class="col-md-12">
                                            <p>Transferencias Recebidas</p>
                                        </div>
                                        <div class="col-md-12 text-left">
                                            - Recebido de: {{ recebida.nome }} - D${{ recebida.valor }}.
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3" *ngIf="etapa.etapa == 2">
                                    <p>Multas Recebidas D${{ etapa.multas }}</p>
                                </div>
                            </div>
                            <h3><span style="color: lightsalmon;">Débitos</span></h3>
                            <div class="row align-items-center">
                                <div class="col-md-3 mb-3" *ngIf="etapa.transferencias.enviado">
                                    <div class="row" *ngFor="let enviada of etapa.transferencias.enviado">
                                        <div class="col-md-12">
                                            <p>Transferencias Enviadas</p>
                                        </div>
                                        <div class="col-md-12 text-left">
                                            - Enviado para: {{ enviada.nome }} - D${{ enviada.valor }}.
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3" *ngIf="etapa.etapa == 2 && etapa.acoesAmbientais.length > 0">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <p>Ações Ambientais feitas:</p>
                                        </div>
                                        <div class="col-md-3" *ngFor="let acao of etapa.acoesAmbientais">
                                            {{ acao }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h3><span style="color: grey;">Info Prefeitura</span></h3>
                            <div class="row align-items-center">
                                <div class="col-md-3 mb-3">
                                    <div class="history-list-info">Caixa Atual: D${{ etapa.saldoAtual }}</div>
                                </div>
                                <div class="col-md-3 mb-3" *ngIf="etapa.etapa == 2 && etapa.impostosModificados.length > 0">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <p>Impostos modificados:</p>
                                        </div>
                                        <div class="col-md-3" *ngFor="let imposto of etapa.impostosModificados">
                                            Imposto {{ imposto.tipo }} <span *ngIf="imposto.tipo==1; else imposto">D$</span>{{ imposto.taxa }}<ng-template #imposto>%</ng-template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <h3><span style="color: grey;">Info Mundo</span></h3>
                            <div class="row align-items-center">
                                <div class="col-md-3 mb-3">
                                    <div class="history-list-info">Poluição Mundial: {{ etapa.poluicaoMundial }}%</div>
                                </div>
                            </div>
                            <hr>
                            <h3><span style="color: grey;">Empresários</span></h3>
                            <div class="container" *ngFor="let empresario of etapa.empresarios">
                                <div class="row align-items-center">
                                    <div class="col-md-12 mb-12">
                                        <div class="history-list-info"><h4>Nome: {{ empresario.nome }}</h4></div>
                                    </div>
                                </div>
                                <div class="row align-items-center">
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Produtividade: D${{ empresario.produtividade }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Imposto: D${{ empresario.imposto }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Poluição: {{ empresario.poluicao }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3" *ngIf="etapa.etapa == 2">
                                        <div class="history-list-info">Multa: D${{ empresario.multa }}</div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <h3><span style="color: grey;">Agricultores</span></h3>
                            <div class="container" *ngFor="let agricultor of etapa.agricultores">
                                <div class="row align-items-center">
                                    <div class="col-md-12 mb-12">
                                        <div class="history-list-info"><h4>Nome: {{ agricultor.nome }}</h4></div>
                                    </div>
                                </div>
                                <div class="row align-items-center">
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Produtividade: D${{ agricultor.produtividade }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Imposto: D${{ agricultor.imposto }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="history-list-info">Poluição: {{ agricultor.poluicaoMedia }}</div>
                                    </div>
                                    <div class="col-md-3 mb-3" *ngIf="etapa.etapa == 2">
                                        <div class="history-list-info">Multa: D${{ agricultor.multa }}</div>
                                    </div>
                                </div>
                                <h5><span style="color: lightblue;">Parcelas</span></h5>
                                <div class="row align-items-center">
                                    <div class="col-md-4 mb-4" *ngFor="let parcela of agricultor.parcelas; let i=index">
                                        <div class="history-list-info">
                                            Parcela: {{ i+1 }}
                                        </div><br>
                                        <div class="history-list-info">
                                            Selo Verde: <span *ngIf="parcela.seloVerde; else seloVerde">Sim</span><ng-template #seloVerde>Não</ng-template>
                                        </div><br>
                                        <div class="history-list-info" *ngIf="parcela.semente">
                                            Semente: {{parcela.semente}}
                                        </div><br>
                                        <div class="history-list-info" *ngIf="parcela.fertilizante">
                                            Fertilizante: {{parcela.fertilizante}}
                                        </div><br>
                                        <div class="history-list-info" *ngIf="parcela.maqAgr">
                                            <span *ngIf="isMaquina(parcela.maqAgr); else agrotoxico">Máquina:</span><ng-template #agrotoxico>Agrotóxico:</ng-template> {{parcela.agrMaq}}
                                        </div><br>
                                        <div class="history-list-info" *ngIf="parcela.pulverizador">
                                            Pulverizador: Sim
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </mat-expansion-panel>
                    </mat-accordion>
                </mat-expansion-panel>
            </mat-accordion>
        </div>  
    </div>
</div>