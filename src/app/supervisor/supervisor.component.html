<app-alert></app-alert>
<div class="content pt-5 pb-5">
    <div *ngIf="(infoMundo$ | async) as mundo">
        <div class="container main__block pt-2 pb-3 pl-3 pr-3">
        
            <app-header
                nomePersonagem="{{infoFis.nome}} (Fiscal)"
                [dinheiros]="infoFis.saldo"
                [cidade]="infoFis.cidade"
                [rodada]="mundo.rodada"
                [poluicaoMundo]="mundo.poluicaoMundo"
            ></app-header>
            <hr>
    
            <i tabindex="0" (keyup.space)="sidebar.toggle()" (click)="sidebar.toggle()" class="fa fa-bars mr-2"></i>
    
            <div class="row">
                <div class="col-md-8 col-xl-7">
                    <mat-tab-group mat-align-tabs="center">
                        <mat-tab label="Ações">
                            <mat-accordion>
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title class="title">
                                            Multar
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <app-fine
                                        [idFis]="idFis"
                                    ></app-fine>
                                    <h4 class="mt-3">Multas a serem aplicadas no fim da jogada:</h4>
                                    <span *ngIf="fines.length == 0">Ainda não foram registradas multas.</span>
                                    <div class="row">
                                        <div class="col-md-3" *ngFor="let fine of fines">
                                            <span class="close" (click)="removeFine(fine)">x</span>
                                            <h5>{{ pessoas[fine.idPessoa-1].nome }}</h5>
                                            <p>Tipo de multa: {{ fine.tipo }}</p>
                                        </div>
                                    </div>
                                </mat-expansion-panel>
                            </mat-accordion>
                            <mat-accordion>
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title class="title">
                                            Selo Verde
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <app-green-seal
                                        [idFis]="idFis"
                                    ></app-green-seal>
                                    <h4 class="mt-3">Selos Verdes a serem aplicados no fim da jogada:</h4>
                                    <span *ngIf="greenSeals.length == 0">Ainda não foram registrados.</span>
                                    <div class="row">
                                        <div class="col-md-3" *ngFor="let greenSeal of greenSeals">
                                            <span class="close" (click)="removeGreenSeal(greenSeal)">x</span>
                                            <h5>{{ pessoas[greenSeal.idAgr-1].nome }}</h5>
                                            <p><span *ngIf="!greenSeal.atribuir">Desa</span><span *ngIf="greenSeal.atribuir">A</span>tribuir nas parcelas:</p>
                                            <div class="row">
                                                <div class="col-md-2" *ngFor="let parcela of greenSeal.parcelas">{{ parcela }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </mat-expansion-panel>
                            </mat-accordion>
                        </mat-tab>
                        <mat-tab label="Tabelas de Valores">
                            <!--app-table-values role='fiscalAmbiental'></app-table-values-->
                        </mat-tab>
                    </mat-tab-group>
                </div>
                <div class="col-md-4 col-xl-5">
                    <a
                        href="/{{idJogo}}/historico-fiscalAmbiental/{{idFis}}"
                        target="_blank"
                        class="btn btn--primary mb-2"
                    >Abrir histórico</a>
                    <app-transfer [idPessoa]="idFis"></app-transfer>
                    <button
                        class="btn btn--secondary mt-3"
                        (click)="finalizarJogada()"
                        [disabled]="!liberaBotao"
                    >Finalizar jogada</button>
                </div>
            </div>
            
            <app-sidebar #sidebar>
                <div class="container">
                    <div class="row">
                        <h3>Agricultores que pediram Selo Verde</h3>
                        <div class="col-md-12 col-md-6" *ngFor="let pedido of infoFis.pedidos">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">{{ pedido }}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </app-sidebar>
        </div>
    </div>
</div>